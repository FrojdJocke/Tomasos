@model TomasosASP.ViewModels.TomasosModel

@using Microsoft.ApplicationInsights.Extensibility.Implementation
@using Microsoft.AspNetCore.Identity
@using TomasosASP.Models
@inject SignInManager<ApplicationUser> SignInManager
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row container-fluid">
    <div class="col-sm-8 col-sm-offset-2 home-col-logoff content" align="center">
        <h1 class="menuhead">Meny</h1>
        @if (User.IsInRole("Premium") || User.IsInRole("Admin"))
        {
            <p>Premiumkunder får 20% orderrabatt vid köp av minst 3 stycken maträtter</p>
        }
    </div>
</div>

<div class="row container-fluid">
    <div class="col-sm-8 col-sm-offset-2 menu-col content-menu">
        @foreach (var type in @Model.Types)
        {
            var typ = type.MatrattTyp1;
            <h1 class="menutype">@type.Beskrivning</h1>
            <br/>
            <hr/>
            foreach (var dish in @Model.Dishes.Where(x => x.MatrattTyp == typ))
            {
                var id = @dish.MatrattId;
                <h3>@dish.MatrattNamn</h3>
                <h4>@dish.Beskrivning</h4>
                <br/>
                <ul>
                    @foreach (var con in @Model.DishIngredientConnection.Where(x => x.MatrattId == id).ToList())
                    {
                        var prod = @Model.Ingredients.SingleOrDefault(x => x.ProduktId == con.ProduktId);
                        <li>@prod.ProduktNamn</li>
                    }
                </ul>
                if (User.IsInRole("Premium") || User.IsInRole("Admin"))
                {
                    if (Model.itemsInCart >= 3)
                    {
                        <h3 id="discount" align="right">Pris: @(dish.Pris * 0.8):-</h3>
                    }
                    else
                    {
                        <h3 align="right">Pris: @dish.Pris:-</h3>
                    }
                }
                else
                {
                    <h3 align="right">Pris: @dish.Pris:-</h3>
                }

                <br/>
                <form asp-controller="Order" asp-action="AddProduct" asp-route-dishID="@dish.MatrattId" 
                      data-ajax="true"
                      data-ajax-method="get"
                      data-ajax-mode="replace"
                      data-ajax-update="#cartIcon">
                    <input type="submit" value="Lägg till"/>
                </form>

                <hr/>
            }
            <br/>
            <br/>
        }



    </div>
</div>